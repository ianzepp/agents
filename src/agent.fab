# ═══════════════════════════════════════════════════════════════════════════════
# AGENS - Instrumentum CLI pro Agentibus AI
# ═══════════════════════════════════════════════════════════════════════════════
#
# Spawns isolated AI agent runs against GitHub repositories.
# Each agent gets its own HOME directory, git worktree, and credentials.
#
# Aedificatio:  faber build src/agent.fab
# Cursus:       bun dist/src/agent.ts --help
# Compilatio:   bun build --compile dist/src/agent.ts --outfile bin/agent
#
# ═══════════════════════════════════════════════════════════════════════════════

# Moduli
ex "./modules/jobs" importa * ut jobsModulum
ex "./modules/personas" importa * ut personaeModulum
ex "./modules/models" importa * ut exemplaresModulum

# Imperia
ex "./commands/run" importa runCommand

@ cli "agent"
@ versio "0.1.0"
@ descriptio "CLI for spawning isolated AI agent runs"
@ imperia "jobs" ex jobsModulum
@ imperia "personas" ex personaeModulum
@ imperia "models" ex exemplaresModulum
incipit argumenta args {}

# ─────────────────────────────────────────────────────────────────────────────
# versio - ostende versionem
# ─────────────────────────────────────────────────────────────────────────────

@ imperium "version"
@ alias "v"
functio version() -> vacuum {
    scribe "agent v0.1.0"
}

# ─────────────────────────────────────────────────────────────────────────────
# run - crea novum agentis munus
# ─────────────────────────────────────────────────────────────────────────────

@ imperium "run"
@ descriptio "Spawn a new agent job"
@ futura
@ optio textus repo brevis "r" longum "repo" descriptio "GitHub repository (owner/repo)"
@ optio numerus issue brevis "i" longum "issue" descriptio "GitHub issue number to work on"
@ optio textus model brevis "m" longum "model" descriptio "Model shortcut or full name"
@ optio textus persona longum "persona" descriptio "Persona to use for the agent"
@ optio bivalens pr longum "pr" descriptio "Create PR when work is complete"
@ optio numerus timeout longum "timeout" descriptio "Timeout in minutes"
@ optio bivalens noValidate longum "no-validate" descriptio "Skip validation step"
functio run(
    textus finis,
    si textus repo,
    si numerus issue,
    si textus model,
    si textus persona,
    si bivalens pr,
    si numerus timeout,
    si bivalens noValidate
) exitus code -> vacuum {
    tempta {
        cede runCommand(finis, repo, issue, model, persona, pr, timeout, noValidate)
    }
    cape err {
        mone "Error:", err textatum
        code = 1
    }
}
