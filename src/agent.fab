# Agent CLI
#
# Compile: faber build src/agent.fab
# Run: bun dist/src/agent.ts --help

# Modules
ex "./modules/jobs" importa * ut jobsModule
ex "./modules/personas" importa * ut personasModule
ex "./modules/models" importa * ut modelsModule

# Commands
ex "./commands/run" importa runCommand

@ cli "agent"
@ versio "0.1.0"
@ descriptio "CLI for spawning isolated AI agent runs"
@ imperia "jobs" ex jobsModule
@ imperia "personas" ex personasModule
@ imperia "models" ex modelsModule
incipit argumenta args {}

@ imperium "version"
@ alias "v"
functio version() -> vacuum {
    scribe "agent v0.1.0"
}

@ imperium "run"
@ descriptio "Spawn a new agent job"
@ futura
@ optio textus repo brevis "r" longum "repo" descriptio "Remote repository"
@ optio numerus issue brevis "i" longum "issue" descriptio "Github issue number"
@ optio textus model brevis "m" longum "model"
@ optio textus persona longum "persona"
@ optio bivalens pr longum "pr"
@ optio numerus timeout longum "timeout"
@ optio bivalens noValidate longum "no-validate"
functio run(
    textus goal,
    si textus repo,
    si numerus issue,
    si textus model,
    si textus persona,
    si bivalens pr,
    si numerus timeout,
    si bivalens noValidate
) exitus code -> vacuum {
    tempta {
        cede runCommand(goal, repo, issue, model, persona, pr, timeout, noValidate)
    }
    cape err {
        mone "Error:", err textatum
        code = 1
    }
}
