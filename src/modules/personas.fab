# ═══════════════════════════════════════════════════════════════════════════════
# PERSONAE - Gestio Personarum Agentium
# ═══════════════════════════════════════════════════════════════════════════════
#
# Personas define agent behavior, style, and default model. Stored as markdown
# files in ~/.agents/personas/ with optional YAML frontmatter.
#
# ═══════════════════════════════════════════════════════════════════════════════

ex "../norma/hal/solum" importa solum

# ─────────────────────────────────────────────────────────────────────────────
# Viae
# ─────────────────────────────────────────────────────────────────────────────

fixum RADIX_AGENTIUM = solum.iunge([solum.domus(), ".agents"])
fixum VIA_PERSONARUM = solum.iunge([RADIX_AGENTIUM, "personas"])

# ─────────────────────────────────────────────────────────────────────────────
# Modulum
# ─────────────────────────────────────────────────────────────────────────────

@ descriptio "Manage agent personas"
incipit {}

# ═══════════════════════════════════════════════════════════════════════════════
# list - enumera personas praesto
# ═══════════════════════════════════════════════════════════════════════════════

@ imperium "list"
@ alias "ls"
@ descriptio "List available personas"
@ futura
functio list() -> vacuum {
    si non solum.exstat(VIA_PERSONARUM) {
        scribe "No personas directory found."
        scribe scriptum("Create personas in §", VIA_PERSONARUM)
        redde
    }

    fixum fasciculi = cede solum.elenca(VIA_PERSONARUM)
    fixum mdFasciculi = fasciculi.filter(pro f: f.endsWith(".md"))

    si mdFasciculi.length == 0 {
        scribe "No personas found."
        redde
    }

    scribe "Available personas:\n"

    ex mdFasciculi pro fasciculus {
        fixum nomen = fasciculus.replace(".md", "")
        fixum via = solum.iunge([VIA_PERSONARUM, fasciculus])
        fixum contentum = cede solum.lege(via)

        # Extrahe descriptionem e frontmatter
        fixum descMatch = contentum.match(sed "^description:\\s*(.+)$" m)
        fixum descriptio = descMatch sic descMatch[1] secus "(no description)"

        # Extrahe exemplar e frontmatter
        fixum modelMatch = contentum.match(sed "^model:\\s*(.+)$" m)
        fixum exemplar = modelMatch sic modelMatch[1] secus "-"

        scribe scriptum("  §\t§\t(§)", nomen, descriptio, exemplar)
    }
}

# ═══════════════════════════════════════════════════════════════════════════════
# show - ostende detalia personae
# ═══════════════════════════════════════════════════════════════════════════════

@ imperium "show"
@ descriptio "Show persona details"
@ futura
functio show(textus nomen) -> vacuum {
    fixum via = solum.iunge([VIA_PERSONARUM, scriptum("§.md", nomen)])

    si non solum.exstat(via) {
        mone scriptum("Persona '§' not found", nomen)
        redde
    }

    fixum contentum = cede solum.lege(via)
    scribe contentum
}
